<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ambition Tracker</title>
  <!-- Include Courier Prime font -->
  <link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">
  <!-- Include Lottie Player for animations -->
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <style>
    /* Reset and basic styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Courier Prime', monospace;
      background-color: #121212;
      color: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      transition: background-color 0.3s, color 0.3s;
      overflow-x: hidden; /* Prevent horizontal scrolling */
      font-size: 1em; /* Base font size */
    }

    /* Header */
    #header {
      width: 100%;
      padding: 1.25em; /* 20px */
      border-bottom: 1px solid #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    #header-left {
      display: flex;
      flex-direction: column;
    }

    #header h1 {
      font-size: 2em; /* 32px */
      font-weight: bold;
      color: #e91e63;
      margin-bottom: 0.3125em; /* 5px */
    }

    #date-display {
      font-size: 0.875em; /* 14px */
      color: #aaaaaa;
    }

    #header-right {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
    }

    #theme-toggle {
      cursor: pointer;
      font-size: 1em; /* 16px */
      padding: 0.625em; /* 10px */
      border: none;
      background: none;
      color: #ffffff;
      transition: color 0.3s;
      margin-right: 1.25em; /* 20px */
    }

    #theme-toggle:hover {
      color: #ff0062;
    }

    #goals-completed {
      font-size: 1em; /* 16px */
      cursor: pointer;
      text-decoration: underline;
      color: #ffffff;
    }

    /* Main content */
    #main {
      padding: 1.25em; /* 20px */
      max-width: 1200px;
      width: 100%;
    }

    /* Goal Section */
    #goal-section {
      display: flex;
      flex-direction: column;
      margin-bottom: 2.5em; /* 40px */
    }

    #goal-form {
      display: flex;
      align-items: center;
      width: 100%;
      margin-bottom: 1.25em; /* 20px */
    }

    #goal-input {
      flex: 1;
      padding: 0.75em 1em; /* 12px 16px */
      font-size: 1em; /* 16px */
      border: 1px solid #555;
      border-radius: 10px;
      background-color: #1e1e1e;
      color: #ffffff;
      margin-right: 0.625em; /* 10px */
    }

    #goal-input::placeholder {
      color: #aaaaaa;
    }

    #add-goal-button {
      padding: 0.75em 1em; /* 12px 16px */
      font-size: 1em; /* 16px */
      background-color: #ff1744;
      border: none;
      border-radius: 10px;
      color: #ffffff;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    #add-goal-button:hover {
      background-color: #ff4569;
    }

    /* Goals */
    .goal {
      margin-bottom: 1.25em; /* 20px */
      border: 1px solid #333;
      padding: 1.25em; /* 20px */
      border-radius: 10px;
      background-color: #1e1e1e;
      width: 100%;
      position: relative;
    }

    .goal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .goal-title {
      font-size: 1.375em; /* 22px */
      color: #ffffff;
      font-weight: bold;
      flex: 1;
      margin-right: 0.625em; /* 10px */
    }

    .priority-label {
      padding: 0.3125em 0.625em; /* 5px 10px */
      border-radius: 10px;
      font-size: 0.875em; /* 14px */
      font-weight: bold;
      color: #000000;
    }

    .priority-high {
      background-color: #ff1744;
    }

    .priority-medium {
      background-color: #ffc400;
    }

    .priority-low {
      background-color: #00e676;
    }

    .goal-buttons {
      display: flex;
      align-items: center;
      margin-top: 0.625em; /* 10px */
      flex-wrap: wrap;
    }

    .goal-button {
      background-color: #2979ff;
      border: none;
      color: #ffffff;
      cursor: pointer;
      font-size: 0.875em; /* 14px */
      font-weight: bold;
      padding: 0.5em 0.75em; /* 8px 12px */
      border-radius: 10px;
      margin-right: 0.625em; /* 10px */
      margin-top: 0.625em; /* 10px */
      transition: background-color 0.3s;
    }

    .goal-button:hover {
      background-color: #5393ff;
    }

    /* Priority Buttons */
    .priority-buttons {
      margin-top: 0.625em; /* 10px */
    }

    .priority-button {
      background-color: #555;
      border: none;
      color: #ffffff;
      cursor: pointer;
      font-size: 0.875em; /* 14px */
      padding: 0.375em 0.625em; /* 6px 10px */
      border-radius: 10px;
      margin-right: 0.3125em; /* 5px */
      transition: background-color 0.3s;
    }

    .priority-button:hover {
      background-color: #777;
    }

    .journal-input {
      width: 100%;
      padding: 0.75em 1em; /* 12px 16px */
      font-size: 0.875em; /* 14px */
      border: 1px solid #555;
      background-color: #1e1e1e;
      color: #ffffff;
      border-radius: 10px;
      margin-top: 0.625em; /* 10px */
      resize: vertical;
    }

    .journal-input::placeholder {
      color: #aaaaaa;
    }

    .entries {
      list-style-type: none;
      padding-left: 0;
      width: 100%;
      margin-top: 0.625em; /* 10px */
    }

    .entry {
      padding: 0.75em 1em; /* 12px 16px */
      margin-bottom: 0.625em; /* 10px */
      background-color: #2e2e2e;
      border-radius: 10px;
      font-size: 0.875em; /* 14px */
      color: #ffffff;
      position: relative;
    }

    .entry:hover .entry-buttons {
      display: flex;
    }

    .entry-buttons {
      position: absolute;
      top: 0.625em; /* 10px */
      right: 0.625em; /* 10px */
      display: none;
      gap: 0.3125em; /* 5px */
    }

    .entry-button {
      background: none;
      border: none;
      color: #ffffff;
      cursor: pointer;
      font-size: 0.875em; /* 14px */
      padding: 0.3125em; /* 5px */
    }

    .entry-button:hover {
      color: #e91e63;
    }

    .entry-date {
      display: block;
      font-size: 0.75em; /* 12px */
      color: #aaaaaa;
      margin-top: 0.3125em; /* 5px */
    }

    .entry-text {
      margin-top: 1.875em; /* 30px - Adjust for button spacing */
    }

    .effort-display {
      font-size: 0.875em; /* 14px */
      color: #00e676;
      margin-top: 0.3125em; /* 5px */
    }

    /* Progress Bars */
    .progress-bar-container {
      width: 100%;
      background-color: #333;
      border-radius: 10px;
      overflow: hidden;
      height: 1.25em; /* 20px */
      margin-top: 0.625em; /* 10px */
    }

    .progress-bar {
      height: 100%;
      background-color: #00e676;
      text-align: center;
      line-height: 1.25em; /* 20px */
      color: #000000;
      font-weight: bold;
      transition: width 0.5s;
    }

    /* Overall Progress */
    #overall-progress {
      width: 100%;
      margin-bottom: 1.25em; /* 20px */
    }

    #overall-progress h2 {
      font-size: 1.125em; /* 18px */
      margin-bottom: 0.625em; /* 10px */
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 1.25em; /* 20px */
      justify-content: space-between;
    }

    .action-button-group {
      display: flex;
      flex-wrap: wrap;
      margin-top: 0.625em; /* 10px */
    }

    .action-button {
      padding: 0.75em 1em; /* 12px 16px */
      font-size: 1em; /* 16px */
      background-color: #2979ff;
      border: none;
      border-radius: 10px;
      color: #ffffff;
      cursor: pointer;
      font-weight: bold;
      margin-right: 0.625em; /* 10px */
      margin-top: 0.625em; /* 10px */
      transition: background-color 0.3s;
    }

    .action-button:hover {
      background-color: #5393ff;
    }

    /* Modals */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(18, 18, 18, 0.95);
    }

    .modal-content {
      background-color: #1e1e1e;
      margin: 5% auto;
      padding: 1.25em; /* 20px */
      border: 1px solid #333;
      width: 90%;
      max-width: 600px;
      border-radius: 10px;
      position: relative;
      color: #ffffff;
    }

    .modal-content h2 {
      margin-top: 0;
    }

    .modal-list {
      list-style-type: none;
      padding: 0;
    }

    .modal-list li {
      padding: 0.625em; /* 10px */
      margin-bottom: 0.625em; /* 10px */
      background-color: #2e2e2e;
      border-radius: 10px;
    }

    .close-modal-button {
      background: none;
      border: none;
      color: #ffffff;
      font-size: 1.5em; /* 24px */
      cursor: pointer;
      position: absolute;
      top: 0.625em; /* 10px */
      right: 1.25em; /* 20px */
    }

    /* Prompt Overlay */
    .prompt-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(18, 18, 18, 0.95);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1001;
    }

    .prompt-content {
      background-color: #1e1e1e;
      padding: 1.25em; /* 20px */
      border-radius: 10px;
      text-align: center;
      width: 90%;
      max-width: 400px;
      color: #ffffff;
    }

    .prompt-content p {
      margin-bottom: 1.25em; /* 20px */
      font-size: 1em; /* 16px */
    }

    .prompt-button {
      padding: 0.625em 1em; /* 10px 16px */
      margin: 0.3125em; /* 5px */
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      font-size: 0.875em; /* 14px */
    }

    .prompt-button:hover {
      opacity: 0.8;
    }

    .prompt-button-primary {
      background-color: #2979ff;
      color: #ffffff;
    }

    .prompt-button-secondary {
      background-color: #555;
      color: #ffffff;
    }

    .prompt-button-delete {
      background-color: #ff1744;
      color: #ffffff;
    }

    .reflection-input {
      width: 100%;
      height: 5em; /* 80px */
      margin-bottom: 1.25em; /* 20px */
      padding: 0.75em 1em; /* 12px 16px */
      border: 1px solid #555;
      border-radius: 10px;
      background-color: #2e2e2e;
      color: #ffffff;
      resize: vertical;
    }

    .reflection-input::placeholder {
      color: #aaaaaa;
    }

    /* Emoji Animation */
    @keyframes riseUp {
      0% {
        transform: translateY(100vh);
        opacity: 0;
      }
      50% {
        opacity: 1;
      }
      100% {
        transform: translateY(-100px);
        opacity: 0;
      }
    }

    .emoji-animation {
      position: fixed;
      bottom: 0;
      font-size: 3.125em; /* 50px */
      animation: riseUp 3s ease-in-out;
      z-index: 1002;
    }

    /* Light Theme */
    body.light-mode {
      background-color: #f5f5f5;
      color: #000000;
    }

    body.light-mode #header {
      border-bottom: 1px solid #ccc;
    }

    body.light-mode #header h1 {
      color: #e91e63;
    }

    body.light-mode #date-display {
      color: #555555;
    }

    body.light-mode #theme-toggle {
      color: #000000;
    }

    body.light-mode #theme-toggle:hover {
      color: #e91e63;
    }

    body.light-mode #goals-completed {
      color: #000000;
    }

    body.light-mode #goal-input {
      background-color: #ffffff;
      color: #000000;
      border: 1px solid #ccc;
    }

    body.light-mode #goal-input::placeholder {
      color: #555;
    }

    body.light-mode #add-goal-button {
      background-color: #ff1744;
    }

    body.light-mode #add-goal-button:hover {
      background-color: #ff4569;
    }

    body.light-mode .goal {
      background-color: #ffffff;
      border: 1px solid #ccc;
    }

    body.light-mode .journal-input {
      background-color: #ffffff;
      color: #000000;
      border: 1px solid #ccc;
    }

    body.light-mode .journal-input::placeholder {
      color: #555;
    }

    body.light-mode .entry {
      background-color: #f5f5f5;
      color: #000000;
    }

    body.light-mode .entry-date {
      color: #555;
    }

    body.light-mode .modal-content {
      background-color: #ffffff;
      color: #000000;
    }

    body.light-mode .prompt-content {
      background-color: #ffffff;
      color: #000000;
    }

    body.light-mode .reflection-input {
      background-color: #f5f5f5;
      color: #000000;
      border: 1px solid #ccc;
    }

    /* Update goal title color in light mode */
    body.light-mode .goal-title {
      color: #000000;
    }

    /* Ensure theme toggle button visibility */
    body.light-mode #theme-toggle {
      color: #000000;
    }

    /* Responsive Enhancements */

    /* Small devices (landscape phones, 576px and up) */
    @media (max-width: 575.98px) {
      #header {
        flex-direction: column;
        align-items: flex-start;
      }

      .goal-buttons {
        flex-direction: column;
        align-items: flex-start;
      }

      .goal-button {
        width: 100%;
        margin-right: 0;
      }

      /* Adjust modals for smaller screens */
      .modal-content {
        width: 95%;
        max-width: 95%;
      }

      /* Adjust Lottie player size */
      lottie-player {
        width: 150px;
        height: 150px;
      }
    }

    /* Medium devices (tablets, 768px and up) */
    @media (max-width: 767.98px) {
      /* Existing styles for .action-buttons */
      .action-buttons {
        flex-direction: column;
        align-items: center;
      }

      .action-button-group {
        justify-content: center;
      }

      /* Adjust progress bars */
      .progress-bar-container {
        height: 0.9375em; /* 15px */
      }

      .progress-bar {
        line-height: 0.9375em; /* 15px */
        font-size: 0.75em; /* 12px */
      }

      /* Adjust Lottie player size */
      lottie-player {
        width: 175px;
        height: 175px;
      }
    }

    /* Large devices (desktops, 992px and up) */
    /* Optional: Add any additional styles for larger screens if needed */
  </style>
</head>
<body>
  <header id="header">
    <div id="header-left">
      <h1>Ambition Tracker</h1>
      <div id="date-display"></div>
    </div>
    <div id="header-right">
      <button id="theme-toggle" aria-label="Toggle Theme">Toggle Theme</button>
      <span id="goals-completed" onclick="toggleCompletedGoalsModal()">Goals Completed: <span id="completed-count">0</span></span>
    </div>
  </header>

  <!-- Modals -->
  <!-- Completed Goals Modal -->
  <div id="completed-goals-modal" class="modal">
    <div class="modal-content">
      <button class="close-modal-button" onclick="toggleCompletedGoalsModal()" aria-label="Close Completed Goals Modal">Ã—</button>
      <h2>Completed Goals</h2>
      <ul id="completed-goals-list" class="modal-list"></ul>
    </div>
  </div>

  <!-- Stats Modal -->
  <div id="stats-modal" class="modal">
    <div class="modal-content">
      <button class="close-modal-button" onclick="toggleStatsModal()" aria-label="Close Stats Modal">Ã—</button>
      <h2>Statistics</h2>
      <div id="stats-content"></div>
    </div>
  </div>

  <!-- Archived Goals Modal -->
  <div id="archived-goals-modal" class="modal">
    <div class="modal-content">
      <button class="close-modal-button" onclick="toggleArchivedGoalsModal()" aria-label="Close Archived Goals Modal">Ã—</button>
      <h2>Archived Goals</h2>
      <ul id="archived-goals-list" class="modal-list"></ul>
    </div>
  </div>

  <main id="main">
    <!-- Overall Progress -->
    <section id="overall-progress">
      <h2>Overall Progress</h2>
      <div class="progress-bar-container">
        <div class="progress-bar" id="overall-progress-bar" style="width: 0%;">0%</div>
      </div>
    </section>

    <!-- Goal Section -->
    <section id="goal-section">
      <form id="goal-form">
        <input type="text" id="goal-input" placeholder="Add a new goal..." required aria-label="Add a new goal">
        <button type="submit" id="add-goal-button">Add Goal</button>
      </form>
    </section>

    <!-- Goals List -->
    <section id="goals"></section>

    <!-- Action Buttons -->
    <section class="action-buttons">
      <div class="action-button-group">
        <button class="action-button" onclick="resetData()" style="background-color: #ff1744;" aria-label="Reset Data">Reset</button>
        <button class="action-button" onclick="toggleStatsModal()" style="background-color: #ff6d00;" aria-label="View Statistics">View Stats</button>
      </div>
      <div class="action-button-group">
        <button class="action-button" onclick="downloadLogs()" aria-label="Download Logs">Download Logs</button>
        <button class="action-button" onclick="toggleArchivedGoalsModal()" aria-label="View Archived Goals">Archived Goals</button>
      </div>
    </section>
  </main>

  <script>
    // Current date setup
    const today = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('date-display').textContent = today.toLocaleDateString(undefined, options);

    // Initialize data from localStorage or set defaults
    let goals = JSON.parse(localStorage.getItem('goals')) || [];
    let totalGoalsCompleted = JSON.parse(localStorage.getItem('totalGoalsCompleted')) || 0;
    let completedGoals = JSON.parse(localStorage.getItem('completedGoals')) || [];
    let reflections = JSON.parse(localStorage.getItem('reflections')) || [];
    let archivedGoals = JSON.parse(localStorage.getItem('archivedGoals')) || [];
    let theme = localStorage.getItem('theme') || 'dark';

    // Apply theme
    applyTheme(theme);

    // Save data to localStorage
    function saveData() {
      localStorage.setItem('goals', JSON.stringify(goals));
      localStorage.setItem('totalGoalsCompleted', JSON.stringify(totalGoalsCompleted));
      localStorage.setItem('completedGoals', JSON.stringify(completedGoals));
      localStorage.setItem('reflections', JSON.stringify(reflections));
      localStorage.setItem('archivedGoals', JSON.stringify(archivedGoals));
    }

    // Reset data
    function resetData() {
      if (confirm('Are you sure you want to reset all data? This action cannot be undone.')) {
        goals = [];
        totalGoalsCompleted = 0;
        completedGoals = [];
        reflections = [];
        archivedGoals = [];
        localStorage.clear();
        saveData();
        updateTotalGoalsCompletedDisplay();
        renderGoals();
        updateOverallProgress();
      }
    }

    // Update total goals completed display
    function updateTotalGoalsCompletedDisplay() {
      const totalGoalsCompletedDisplay = document.getElementById('completed-count');
      totalGoalsCompletedDisplay.textContent = totalGoalsCompleted;
    }

    // Add goal function
    function addGoal(event) {
      event.preventDefault();
      const goalInput = document.getElementById('goal-input');
      const goalText = goalInput.value.trim();
      if (goalText === '') return;

      if (goals.length >= 5) {
        alert('You have reached the limit of 5 active goals. The new goal will be archived.');
        archivedGoals.push({
          title: goalText,
          entries: [],
          priority: 'Low',
          createdAt: Date.now()
        });
        saveData();
        renderArchivedGoals();
        goalInput.value = '';
        return;
      }

      goals.push({
        title: goalText,
        entries: [],
        priority: 'Low',
        createdAt: Date.now()
      });
      goalInput.value = '';
      saveData();
      renderGoals();
      updateOverallProgress();
    }

    // Render goals
    function renderGoals() {
      const goalsDiv = document.getElementById('goals');
      goalsDiv.innerHTML = '';

      if (!goals || goals.length === 0) {
        goalsDiv.innerHTML = '<p>No active goals. Add a goal to get started!</p>';
        return;
      }

      goals.forEach((goal, index) => {
        const goalElement = createGoalElement(goal, index);
        goalsDiv.appendChild(goalElement);
      });

      updateOverallProgress();
    }

    // Create Goal Element Function
    function createGoalElement(goal, index) {
      const goalDiv = document.createElement('div');
      goalDiv.className = 'goal';

      // Goal Header
      const goalHeader = document.createElement('div');
      goalHeader.className = 'goal-header';

      // Goal Title
      const goalTitle = document.createElement('div');
      goalTitle.className = 'goal-title';
      goalTitle.textContent = goal.title;

      // Priority Label
      const priorityLabel = document.createElement('div');
      priorityLabel.className = 'priority-label';
      priorityLabel.textContent = goal.priority;
      priorityLabel.classList.add(`priority-${goal.priority.toLowerCase()}`);

      goalHeader.appendChild(goalTitle);
      goalHeader.appendChild(priorityLabel);

      goalDiv.appendChild(goalHeader);

      // Priority Buttons
      const priorityButtonsDiv = document.createElement('div');
      priorityButtonsDiv.className = 'priority-buttons';

      ['High', 'Medium', 'Low'].forEach(level => {
        const priorityButton = document.createElement('button');
        priorityButton.className = 'priority-button';
        priorityButton.textContent = level;
        priorityButton.addEventListener('click', function() {
          goal.priority = level;
          saveData();
          renderGoals();
        });
        priorityButtonsDiv.appendChild(priorityButton);
      });

      goalDiv.appendChild(priorityButtonsDiv);

      // Goal Buttons
      const goalButtons = document.createElement('div');
      goalButtons.className = 'goal-buttons';

      // Edit Goal Button
      const editGoalButton = document.createElement('button');
      editGoalButton.className = 'goal-button';
      editGoalButton.textContent = 'Edit Goal';

      editGoalButton.addEventListener('click', function() {
        const newTitle = prompt('Edit Goal Title:', goal.title);
        if (newTitle !== null && newTitle.trim() !== '') {
          goal.title = newTitle.trim();
          saveData();
          renderGoals();
        }
      });

      // Complete Goal Button
      const completeGoalButton = document.createElement('button');
      completeGoalButton.className = 'goal-button';
      completeGoalButton.textContent = 'Complete Goal';

      completeGoalButton.addEventListener('click', function() {
        completeGoal(goal, index);
      });

      goalButtons.appendChild(editGoalButton);
      goalButtons.appendChild(completeGoalButton);

      goalDiv.appendChild(goalButtons);

      // Journal Input
      const journalInput = document.createElement('textarea');
      journalInput.className = 'journal-input';
      journalInput.placeholder = 'Write your journal entry here...';
      journalInput.setAttribute('aria-label', 'Journal Entry');

      journalInput.addEventListener('keydown', function(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
          event.preventDefault();
          const entryText = journalInput.value.trim();
          if (entryText !== '') {
            addEntry(goal, entryText);
            journalInput.value = '';
          }
        }
      });

      goalDiv.appendChild(journalInput);

      // Entries
      if (goal.entries && goal.entries.length > 0) {
        const entriesList = document.createElement('ul');
        entriesList.className = 'entries';

        goal.entries.forEach((entry, entryIndex) => {
          const entryItem = document.createElement('li');
          entryItem.className = 'entry';

          const entryText = document.createElement('div');
          entryText.className = 'entry-text';
          entryText.textContent = entry.text;
          entryText.contentEditable = false;
          entryText.setAttribute('aria-label', 'Journal Entry Text');

          entryText.addEventListener('click', function() {
            entryText.contentEditable = true;
            entryText.focus();
          });

          entryText.addEventListener('blur', function() {
            entry.text = entryText.textContent.trim();
            entry.date = new Date().toISOString();
            saveData();
            renderGoals();
          });

          const entryDate = document.createElement('span');
          entryDate.className = 'entry-date';
          entryDate.textContent = `(${new Date(entry.date).toLocaleString()})`;

          const entryButtons = document.createElement('div');
          entryButtons.className = 'entry-buttons';

          // Edit Entry Button
          const editEntryButton = document.createElement('button');
          editEntryButton.className = 'entry-button';
          editEntryButton.textContent = 'Edit';

          editEntryButton.addEventListener('click', function() {
            entryText.contentEditable = true;
            entryText.focus();
          });

          // Delete Entry Button
          const deleteEntryButton = document.createElement('button');
          deleteEntryButton.className = 'entry-button';
          deleteEntryButton.textContent = 'Delete';

          deleteEntryButton.addEventListener('click', function() {
            if (confirm('Are you sure you want to delete this entry?')) {
              goal.entries.splice(entryIndex, 1);
              saveData();
              renderGoals();
            }
          });

          // Rate Effort Button
          const rateEffortButton = document.createElement('button');
          rateEffortButton.className = 'entry-button';
          rateEffortButton.textContent = 'Rate Effort';

          rateEffortButton.addEventListener('click', function() {
            showEffortRatingPrompt(goal, entry);
          });

          // Place Edit and Delete buttons at the top
          entryButtons.appendChild(editEntryButton);
          entryButtons.appendChild(deleteEntryButton);

          // Append buttons and text to entry item
          entryItem.appendChild(entryButtons);
          entryItem.appendChild(entryText);

          // Rate Effort Button below Edit and Delete
          const rateEffortButtonContainer = document.createElement('div');
          rateEffortButtonContainer.style.marginTop = '0.625em'; /* 10px */
          rateEffortButtonContainer.appendChild(rateEffortButton);
          entryItem.appendChild(rateEffortButtonContainer);

          // Display Effort Rating if it exists and is greater than 0
          if (entry.effortRating && entry.effortRating > 0) {
            const effortDisplay = document.createElement('div');
            effortDisplay.className = 'effort-display';
            effortDisplay.textContent = `Effort: ${entry.effortRating}/10`;
            entryItem.appendChild(effortDisplay);
          }

          entryItem.appendChild(entryDate);

          entriesList.appendChild(entryItem);
        });

        goalDiv.appendChild(entriesList);
      }

      // Goal Progress Bar
      const progressContainer = document.createElement('div');
      progressContainer.className = 'progress-bar-container';

      const progressBar = document.createElement('div');
      progressBar.className = 'progress-bar';

      let progressPercentage = calculateGoalProgress(goal);

      progressBar.style.width = `${progressPercentage}%`;
      progressBar.textContent = `${Math.floor(progressPercentage)}%`;

      progressContainer.appendChild(progressBar);
      goalDiv.appendChild(progressContainer);

      return goalDiv;
    }

    // Calculate Goal Progress
    function calculateGoalProgress(goal) {
      // Filter entries that have an effortRating greater than 0
      const ratedEntries = goal.entries.filter(entry => entry.effortRating > 0);
      const totalPossibleEffort = ratedEntries.length * 10;
      const actualEffort = ratedEntries.reduce((sum, entry) => sum + entry.effortRating, 0);
      const progressPercentage = totalPossibleEffort ? (actualEffort / totalPossibleEffort) * 100 : 0;
      return progressPercentage > 100 ? 100 : progressPercentage;
    }

    // Calculate Overall Progress
    function calculateOverallProgress() {
      if (goals.length === 0) return 0;
      const totalProgress = goals.reduce((sum, goal) => sum + calculateGoalProgress(goal), 0);
      return goals.length > 0 ? (totalProgress / goals.length) : 0;
    }

    // Update Overall Progress
    function updateOverallProgress() {
      const overallProgressBar = document.getElementById('overall-progress-bar');
      const overallProgressPercentage = calculateOverallProgress();
      overallProgressBar.style.width = `${overallProgressPercentage}%`;
      overallProgressBar.textContent = `${Math.floor(overallProgressPercentage)}%`;
    }

    // Add Entry Function
    function addEntry(goal, entryText) {
      const newEntry = {
        text: entryText,
        date: new Date().toISOString(),
        effortRating: 0 // Default to 0, indicating no rating yet
      };
      goal.entries.unshift(newEntry);
      saveData();
      renderGoals();
      promptEffortRatingOption(goal, newEntry);
    }

    // Prompt Effort Rating Option
    function promptEffortRatingOption(goal, entry) {
      const promptOverlay = document.createElement('div');
      promptOverlay.className = 'prompt-overlay';

      const promptContent = document.createElement('div');
      promptContent.className = 'prompt-content';

      const promptText = document.createElement('p');
      promptText.textContent = 'Would you like to rate your effort?';

      const yesButton = document.createElement('button');
      yesButton.className = 'prompt-button prompt-button-primary';
      yesButton.textContent = 'Yes';

      const noButton = document.createElement('button');
      noButton.className = 'prompt-button prompt-button-secondary';
      noButton.textContent = 'No';

      yesButton.onclick = function() {
        document.body.removeChild(promptOverlay);
        showEffortRatingPrompt(goal, entry);
      };

      noButton.onclick = function() {
        document.body.removeChild(promptOverlay);
        // No action needed, entry.effortRating remains 0 and is excluded from progress
      };

      promptContent.appendChild(promptText);
      promptContent.appendChild(yesButton);
      promptContent.appendChild(noButton);
      promptOverlay.appendChild(promptContent);
      document.body.appendChild(promptOverlay);
    }

    // Show Effort Rating Prompt Function with Integrated lottie-player
    function showEffortRatingPrompt(goal, entry) {
      const promptOverlay = document.createElement('div');
      promptOverlay.className = 'prompt-overlay';

      const promptContent = document.createElement('div');
      promptContent.className = 'prompt-content';

      const promptText = document.createElement('p');
      promptText.textContent = 'Rate your effort:';

      // lottie-player Element
      const lottiePlayer = document.createElement('lottie-player');
      lottiePlayer.setAttribute('src', 'https://lottie.host/f889381a-20db-4e00-9f30-f0c05b754e65/plsaT7x7r6.json');
      lottiePlayer.setAttribute('background', 'transparent');
      lottiePlayer.setAttribute('speed', '1');
      lottiePlayer.setAttribute('style', 'width: 200px; height: 200px; margin: 0 auto;');
      lottiePlayer.setAttribute('loop', '');
      lottiePlayer.setAttribute('autoplay', '');

      // Effort Rating Slider
      const effortSlider = document.createElement('input');
      effortSlider.type = 'range';
      effortSlider.min = '1';
      effortSlider.max = '10';
      effortSlider.value = entry.effortRating > 0 ? entry.effortRating : '1';
      effortSlider.style.width = '100%';
      effortSlider.style.marginTop = '0.625em'; /* 10px */

      const effortDisplay = document.createElement('div');
      effortDisplay.style.fontSize = '1.5em'; /* 24px */
      effortDisplay.style.margin = '0.625em 0'; /* 10px 0 */
      effortDisplay.textContent = `Effort: ${effortSlider.value}/10`;

      effortSlider.oninput = function() {
        effortDisplay.textContent = `Effort: ${effortSlider.value}/10`;
        // Adjust animation speed based on effort
        lottiePlayer.speed = effortSlider.value / 5; // Adjust speed ratio as needed
      };

      const submitButton = document.createElement('button');
      submitButton.className = 'prompt-button prompt-button-primary';
      submitButton.textContent = 'Submit';

      submitButton.onclick = function() {
        entry.effortRating = parseInt(effortSlider.value);
        saveData();
        renderGoals();
        updateOverallProgress();
        document.body.removeChild(promptOverlay);
      };

      const cancelButton = document.createElement('button');
      cancelButton.className = 'prompt-button prompt-button-secondary';
      cancelButton.textContent = 'Cancel';

      cancelButton.onclick = function() {
        document.body.removeChild(promptOverlay);
        // Entry.effortRating remains 0 and is excluded from progress
      };

      promptContent.appendChild(promptText);
      promptContent.appendChild(lottiePlayer);
      promptContent.appendChild(effortDisplay);
      promptContent.appendChild(effortSlider);
      promptContent.appendChild(submitButton);
      promptContent.appendChild(cancelButton);
      promptOverlay.appendChild(promptContent);
      document.body.appendChild(promptOverlay);

      // Play the animation
      lottiePlayer.play();
    }

    // Complete Goal Function
    function completeGoal(goal, index) {
      totalGoalsCompleted += 1;
      completedGoals.push({
        title: goal.title,
        completedAt: new Date().toISOString()
      });

      // Remove the goal from active goals
      goals.splice(index, 1);

      // Show completion animation
      showCompletionAnimation();

      saveData();
      updateTotalGoalsCompletedDisplay();
      renderGoals();
      updateOverallProgress();
    }

    // Show Completion Animation Function
    function showCompletionAnimation() {
      const emojisContainer = document.createElement('div');
      emojisContainer.className = 'emojis-container';
      document.body.appendChild(emojisContainer);

      for (let i = 0; i < 30; i++) {
        const emoji = document.createElement('div');
        emoji.className = 'emoji-animation';
        emoji.textContent = 'ðŸ˜Ž';
        emoji.style.left = Math.random() * 100 + '%';
        emoji.style.animationDelay = (Math.random() * 2) + 's';
        emojisContainer.appendChild(emoji);
      }

      setTimeout(() => {
        document.body.removeChild(emojisContainer);
      }, 5000);
    }

    // Toggle Completed Goals Modal
    function toggleCompletedGoalsModal() {
      const modal = document.getElementById('completed-goals-modal');
      if (modal.style.display === 'block') {
        modal.style.display = 'none';
      } else {
        renderCompletedGoals();
        modal.style.display = 'block';
      }
    }

    // Render Completed Goals
    function renderCompletedGoals() {
      const completedGoalsList = document.getElementById('completed-goals-list');
      completedGoalsList.innerHTML = '';

      if (completedGoals.length === 0) {
        completedGoalsList.innerHTML = '<li>No completed goals yet.</li>';
        return;
      }

      completedGoals.forEach(goal => {
        const listItem = document.createElement('li');
        const goalTitle = document.createElement('div');
        goalTitle.textContent = goal.title;
        goalTitle.style.fontWeight = 'bold';

        const completionDate = document.createElement('div');
        completionDate.textContent = `Completed on: ${new Date(goal.completedAt).toLocaleString()}`;
        completionDate.style.fontSize = '0.75em'; /* 12px */
        completionDate.style.color = '#aaaaaa';

        listItem.appendChild(goalTitle);
        listItem.appendChild(completionDate);

        completedGoalsList.appendChild(listItem);
      });
    }

    // Toggle Stats Modal
    function toggleStatsModal() {
      const modal = document.getElementById('stats-modal');
      if (modal.style.display === 'block') {
        modal.style.display = 'none';
      } else {
        renderStats();
        modal.style.display = 'block';
      }
    }

    // Render Stats
    function renderStats() {
      const statsContent = document.getElementById('stats-content');
      statsContent.innerHTML = '';

      const totalGoalsCompletedStat = document.createElement('p');
      totalGoalsCompletedStat.textContent = `Total Goals Completed: ${totalGoalsCompleted}`;

      const totalJournalEntries = goals.reduce((sum, goal) => sum + goal.entries.length, 0) + completedGoals.reduce((sum, goal) => sum + (goal.entries ? goal.entries.length : 0), 0);

      const totalJournalEntriesStat = document.createElement('p');
      totalJournalEntriesStat.textContent = `Total Journal Entries: ${totalJournalEntries}`;

      const totalEffort = goals.reduce((sum, goal) => sum + goal.entries.reduce((esum, entry) => esum + (entry.effortRating || 0), 0), 0);
      const effortCount = goals.reduce((sum, goal) => sum + goal.entries.filter(entry => entry.effortRating > 0).length, 0);

      const averageEffortRating = effortCount ? (totalEffort / effortCount).toFixed(2) : 0;

      const averageEffortRatingStat = document.createElement('p');
      averageEffortRatingStat.textContent = `Average Effort Rating: ${averageEffortRating}`;

      // Time spent on goals is not tracked directly, so we'll approximate based on entries
      const timeSpent = totalJournalEntries * 5; // Assuming 5 minutes per entry
      const timeSpentStat = document.createElement('p');
      timeSpentStat.textContent = `Estimated Time Spent on Goals: ${timeSpent} minutes`;

      statsContent.appendChild(totalGoalsCompletedStat);
      statsContent.appendChild(totalJournalEntriesStat);
      statsContent.appendChild(averageEffortRatingStat);
      statsContent.appendChild(timeSpentStat);
    }

    // Toggle Archived Goals Modal
    function toggleArchivedGoalsModal() {
      const modal = document.getElementById('archived-goals-modal');
      if (modal.style.display === 'block') {
        modal.style.display = 'none';
      } else {
        renderArchivedGoals();
        modal.style.display = 'block';
      }
    }

    // Render Archived Goals
    function renderArchivedGoals() {
      const archivedGoalsList = document.getElementById('archived-goals-list');
      archivedGoalsList.innerHTML = '';

      if (archivedGoals.length === 0) {
        archivedGoalsList.innerHTML = '<li>No archived goals.</li>';
        return;
      }

      archivedGoals.forEach((goal, index) => {
        const listItem = document.createElement('li');
        const goalTitle = document.createElement('div');
        goalTitle.textContent = goal.title;
        goalTitle.style.fontWeight = 'bold';

        const activateButton = document.createElement('button');
        activateButton.className = 'goal-button';
        activateButton.textContent = 'Activate Goal';
        activateButton.addEventListener('click', function() {
          if (goals.length >= 5) {
            alert('You have reached the limit of 5 active goals. Please complete or archive existing goals first.');
            return;
          }
          goals.push(goal);
          archivedGoals.splice(index, 1);
          saveData();
          renderGoals();
          renderArchivedGoals();
        });

        listItem.appendChild(goalTitle);
        listItem.appendChild(activateButton);

        archivedGoalsList.appendChild(listItem);
      });
    }

    // Download Logs Function
    function downloadLogs() {
      const data = {
        goals: goals,
        totalGoalsCompleted: totalGoalsCompleted,
        completedGoals: completedGoals,
        reflections: reflections,
        archivedGoals: archivedGoals,
        dateExported: new Date().toISOString(),
      };
      const dataStr = JSON.stringify(data, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      const dateString = new Date().toISOString().split('T')[0];
      a.download = `AmbitionTrackerLogs_${dateString}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Theme Toggle
    function applyTheme(theme) {
      if (theme === 'light') {
        document.body.classList.add('light-mode');
      } else {
        document.body.classList.remove('light-mode');
      }
      localStorage.setItem('theme', theme);
    }

    document.getElementById('theme-toggle').addEventListener('click', function() {
      theme = theme === 'dark' ? 'light' : 'dark';
      applyTheme(theme);
    });

    // Initial render
    updateTotalGoalsCompletedDisplay();
    renderGoals();
    updateOverallProgress();

    // Add goal form event listener
    document.getElementById('goal-form').addEventListener('submit', addGoal);
  </script>
</body>
</html>
